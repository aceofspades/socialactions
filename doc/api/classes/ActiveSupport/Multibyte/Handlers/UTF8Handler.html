<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><title>Class: ActiveSupport::Multibyte::Handlers::UTF8Handler</title><link type="text/css" href="../../../.././rdoc-style.css" media="screen" rel="stylesheet"/><script type="text/javascript">
// Allison template
// Copyright 2007, 2008 Cloudburst, LLC. Licensed under the AFL 3. See the included LICENSE file.

var href_base = '../../../.././rdoc-style.css'.replace(/(.*\/).*/, '$1'); // inline js is good for something  

function $(id) {
    if (document.getElementById)
      elem = document.getElementById(id);
    else if ( document.all )
      elem = eval("document.all." + id);
    else
      return false;
    return elem;
}

  function toggle(id) {
    elem = $(id);
    elemStyle = elem.style;   
    if (elemStyle.display == "block") {
      elemStyle.display = "none"
    } else {
      elemStyle.display = "block"
    }
    return true;
  }

  function toggleText(id) {
    elem = $(id)
    if (m = elem.innerHTML.match(/(Hide)(.*)/)) {
      elem.innerHTML = "Show" + m[2];
    } else if (m = elem.innerHTML.match(/(Show)(.*)/)) {
      elem.innerHTML = "Hide" + m[2];
    }
    return true;
  }

function span(s, klass) {
  return '<span class="' + klass + '">' + s + '</span>';
}
  
function highlightSymbols() {
  pres = document.getElementsByTagName('pre');
  for(var i = 0; i < pres.length; i++) {
    pre = pres[i];
    spans = pre.getElementsByTagName('span');
    for(var k = 0; k < spans.length; k++) {
      span = spans[k];
      if (span.className.match(/ruby-identifier/)) {
        if (span.innerHTML.match(/^:/)) {
          span.className += " ruby-symbol";
        }
      }
    }
  }
}

 function hasClass(obj) {
     var result = false;
     if (obj.getAttributeNode("class") != null) {
         result = obj.getAttributeNode("class").value;
     }
     return result;
  }   

 function stripe() {
    var even = true;
    var color = "#e4ebed";
    var tables = document.getElementsByTagName('table');
    if (tables.length == 0) { return; }
    for (var h = 0; h < tables.length; h++) {
        var trs = tables[h].getElementsByTagName("tr");
        for (var i = 0; i < trs.length; i++) {
          var tds = trs[i].getElementsByTagName("td");
            for (var j = 0; j < tds.length; j++) {       
              if (hasClass(tds[j]) != "first") {                
              var mytd = tds[j];
              if (even) {
                mytd.style.backgroundColor = color;
              }         
            }
          }
          even =  ! even;
      }
    }
  }
  
function ajaxGet(url) {
  url = (href_base + url).replace('/./', '/')
  var req = false;

  if (window.ActiveXObject) {
    try {
      // stupid hack because IE7 disables local Ajax with the native xmlhttprequest object
      // for security purposes. Yet ActiveX still works. Thanks, Microsoft. I hate you. Die.
      req = new ActiveXObject("MSXML2.XMLHTTP.3.0");
    } catch (e) {
      try {
        /* IE 6 and maybe 5, don't know, don't care */
        req = new ActiveXObject("Msxml2.XMLHTTP");
      } catch (e) {
        try {
          req = new ActiveXObject("Microsoft.XMLHTTP");
        } catch (e) {
          req = false;
        }
      }
    }
  }
    
  /* real browsers */
  if (!req && window.XMLHttpRequest) {
    try {
      req = new XMLHttpRequest();
    } catch (e) {
      req = false;
    }
  } 
  
  if (req) {
    req.open('GET', url, false);
    req.send(null);
    return req.responseText;
  } else {
    return "Ajax error";  
  }
}


function addEvent(elm, evType, fn, useCapture) {
	if (elm.addEventListener) {
	  elm.addEventListener(evType, fn, useCapture);  
  	return true;
	} else if (elm.attachEvent) {
  	var r = elm.attachEvent('on' + evType, fn);  
	  return r;  
	} else {
  	elm['on' + evType] = fn;
	}
}

function insertIndices() {
  pages = ["class", "file", "method"]
  for (x in pages) { 
    $(pages[x]).innerHTML += ajaxGet('fr_' + pages[x] + '_index.html').replace(/(href=")/g, '$1' + href_base);
  }
  /* mouseoverify method links */
  links = $('method').getElementsByTagName('a');
  for (var x = 0; x < links.length; x++) {
    if (m = links[x].innerHTML.match(/(.*)\s\((.*)\)/)) {
      links[x].innerHTML = m[1] + '<br>';
      links[x].title = m[2];
    }
  }
  /* this is stupid */
  $('class').style.display = "block";
  $('file').style.display = "block";
  
  /* has to be here because IE7 does not guarantee the onLoad callback order */
  abbreviateIndicesInner(["class", "file"], 25, "a");
  /* same, linkTitle() depends on the class link list */
  linkTitle();
}

function abbreviateIndices() {
  var ids = ["defined_in", "child_of", "includes", "requires", "method", "methods"];
  abbreviateIndicesInner(ids, 25, 'a');
  abbreviateIndicesInner(ids, 25, 'span');
}

function abbreviateIndicesInner(indices, amount, tag) {
  for (var x = 0; x < indices.length; x++) { 
    var the_index = $(indices[x]);
    if (the_index) {
      links = the_index.getElementsByTagName(tag);
      for (var y = 0; y < links.length; y++) {
        var link = links[y];
        if (link.getElementsByTagName('span').length == 0 && link.getElementsByTagName('a').length == 0) {
          // avoid nesting
          link.innerHTML = link.innerHTML.replace(/<br>|\n/gi, '');
          link.title = link.innerHTML;
          link.innerHTML = abbreviate(link.innerHTML, amount) + '<br>';
        }
      }
    }
  }
}

function linkTitle() {
  
  /* grab the correct title element from the index */
  var index_page = ajaxGet('index.html');
  title_text = index_page.match(/<title>(.*)<\/title>/m)[1];
  document.title = title_text + " - " + document.title;
  var p = $('header').getElementsByTagName('p')[0]
  if (p.innerHTML.match(/^\s*$/)) {
    p.innerHTML = title_text;
  } else {
    p.innerHTML = title_text + ": " + p.innerHTML;
  }
  
  /* set the link properly */
  title_link = index_page.match(/<a\s+href="(.*?)"/)[1];
  var element = $('title');
  var item_type = "";
  var item_name = "";
  if (m = element.innerHTML.match(/(Class:|Module:|File:)\s*(.*)/)) {
    item_type = m[1];
    item_name = m[2];
  } else {
    item_name = element.innerHTML;
  }
  element.innerHTML = '<a href="' + href_base + title_link + '">' + item_type + " " + abbreviate(item_name, 45) + '</a>';
  element.getElementsByTagName('a')[0].title = item_name
  
  /* breadcrumb navigation */
  items = item_name.split("::");
  items_new = item_name.split("::");
  file_links = $('class').getElementsByTagName('a');
  for (var x = 0; x < items.length - 1; x++ ){
    var item = items[x];
    link = ("/classes/" + items.slice(0,x).join("/") + "/" + item + ".html").replace('//', '/');
    regex = new RegExp(RegExp.escape(link) + '$');
    for (var y = 0; y < file_links.length; y++) {
      if (file_links[y].href.match(regex)) {
         items_new[x] = '<a href="' + href_base + link + '">' + item + '</a>';
         break;
      }
    }  
  }
  $('item_name').innerHTML = item_type + ' ' + items_new.join(" :: ");
}

function abbreviate(s, size) {
  while (s.length > size) {
    var old_s = s;
    s = s.replace(/\s|\n/mg, '');
    s = s.replace(/([A-Z])[a-z]+/m, '$1');
    if (!s || old_s == s) {
      return "..." + s.substring(s.length - size, s.length);
    }
  }
  return s;
}

function disableSubmit(event) {
  var keyCode = event.keyCode ? event.keyCode : event.which ? event.which : event.charCode;
  if (keyCode == 13) {
    return false;
  } else {
    return true;
  }
}
  
function filterList(id, s, event) {
  
  /* some weak escaping */
  s = s.replace(/[^\w\d\.\_\-\/\:\=\[\]\?\!]/g, '');
  s = RegExp.escape(s);
  
  var show_all = false;
  if (s.match(/^\s*$/)) {
    show_all = true;
  }
  
  links = $(id).getElementsByTagName('a')
  regex = new RegExp(s, 'i');
  
  for (var x = 0; x < links.length; x++) {
    var link = links[x];
    if (show_all) {
      link.style.display = 'inline';
    } else {
       if (link.innerHTML.match(regex)) {        
         link.style.display = 'inline';
       } else {
         link.style.display = 'none';
       }
    }
  }
  return true;
}

RegExp.escape = function(text) {
  if (!arguments.callee.sRE) {
    var specials = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\'];
    arguments.callee.sRE = new RegExp(
      '(\\' + specials.join('|\\') + ')', 'g'
    );
  }
  return text.replace(arguments.callee.sRE, '\\$1');
}

function hacks() {
  // show the spacer if necessary, 
  divs = document.getElementsByTagName('div');
  for(var x = 0; x < divs.length; x++) {
    if (divs[x].className && divs[x].className.match(/top/)) {
      document.getElementById('spacer').style.display = 'block';
    }
  }
  // remove extra colons from tables
  tds = document.getElementsByTagName('td');
  for(var x = 0; x < tds.length; x++) {
    str = tds[x].innerHTML
    if (str.charAt(str.length - 1) == ":") {
      tds[x].innerHTML = str.slice(0, str.length - 1)
    }
  }
}

addEvent(window, 'load', insertIndices, false);
addEvent(window, 'load', abbreviateIndices, false);
addEvent(window, 'load', stripe, false);
addEvent(window, 'load', highlightSymbols, false);
addEvent(window, 'load', hacks, false);
</script></head><body><div id="container"><div class="curve" id="preheader_curve_0"></div><div class="curve" id="preheader_curve_1"></div><div class="curve" id="preheader_curve_2"></div><div class="curve" id="preheader_curve_3"></div><div class="curve" id="preheader_curve_4"></div><div class="curve" id="preheader_curve_5"></div><div id="header"><p>
</p><span><h1 id="title">
Class: ActiveSupport::Multibyte::Handlers::UTF8Handler
</h1></span>
</div><div class="clear"></div><div id="left">
<div class="navigation darker top" id="child_of"><h3>Child of</h3><span>

<a href='../../../Object.html'>
Object
</a>
</span></div>

<div class="navigation darker top" id="defined_in"><h3>Defined in</h3>

<a href="../../../../files/vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler_rb.html">vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb</a>

</div>



<div class="navigation top" id="methods"><h3>Methods</h3>


<a href='#M000558'>
[]=<br/>
</a>




<a href='#M000570'>
capitalize<br/>
</a>




<a href='#M000561'>
center<br/>
</a>




<a href='#M000573'>
compose<br/>
</a>




<a href='#M000587'>
compose_codepoints<br/>
</a>




<a href='#M000575'>
consumes?<br/>
</a>




<a href='#M000572'>
decompose<br/>
</a>




<a href='#M000586'>
decompose_codepoints<br/>
</a>




<a href='#M000569'>
downcase<br/>
</a>




<a href='#M000576'>
g_length<br/>
</a>




<a href='#M000581'>
g_pack<br/>
</a>




<a href='#M000580'>
g_unpack<br/>
</a>




<a href='#M000578'>
in_char_class?<br/>
</a>




<a href='#M000557'>
index<br/>
</a>




<a href='#M000556'>
insert<br/>
</a>




<a href='#M000582'>
justify<br/>
</a>




<a href='#M000560'>
ljust<br/>
</a>




<a href='#M000563'>
lstrip<br/>
</a>




<a href='#M000571'>
normalize<br/>
</a>




<a href='#M000583'>
padding<br/>
</a>




<a href='#M000585'>
reorder_characters<br/>
</a>




<a href='#M000566'>
reverse<br/>
</a>




<a href='#M000559'>
rjust<br/>
</a>




<a href='#M000562'>
rstrip<br/>
</a>




<a href='#M000565'>
size<br/>
</a>




<a href='#M000567'>
slice<br/>
</a>




<a href='#M000564'>
strip<br/>
</a>




<a href='#M000577'>
tidy_bytes<br/>
</a>




<a href='#M000584'>
to_case<br/>
</a>




<a href='#M000574'>
translate_offset<br/>
</a>




<a href='#M000579'>
u_unpack<br/>
</a>




<a href='#M000568'>
upcase<br/>
</a>


</div>
<div id="spacer"></div><div class="navigation darker index" id="class_wrapper"><div class="list_header"><h3>All classes</h3></div><div class="list_header_link"><a onclick="toggle('class'); toggleText('class_link'); return false;" href="#" id="class_link">Hide...</a></div><div class="clear"></div><div id="class"><form><label for="filter_class">Filter:&nbsp;&nbsp;</label><input type="text" onKeyUp="return filterList('class', this.value, event);" onKeyPress="return disableSubmit(event);" id="filter_class"></input></form></div></div><div class="navigation darker index" id="file_wrapper"><div class="list_header"><h3>All files</h3></div><div class="list_header_link"><a onclick="toggle('file'); toggleText('file_link'); return false;" href="#" id="file_link">Hide...</a></div><div class="clear"></div><div id="file"><form><label for="filter_file">Filter:&nbsp;&nbsp;</label><input type="text" onKeyUp="return filterList('file', this.value, event);" onKeyPress="return disableSubmit(event);" id="filter_file"></input></form></div></div><div class="navigation darker index" id="method_wrapper"><div class="list_header"><h3>All methods</h3></div><div class="list_header_link"><a onclick="toggle('method'); toggleText('method_link'); return false;" href="#" id="method_link">Show...</a></div><div class="clear"></div><div id="method"><form><label for="filter_method">Filter:&nbsp;&nbsp;</label><input type="text" onKeyUp="return filterList('method', this.value, event);" onKeyPress="return disableSubmit(event);" id="filter_method"></input></form></div></div></div><div id="content">
<h1 id="item_name">Class: ActiveSupport::Multibyte::Handlers::UTF8Handler</h1>

<div id="description"><p>
<a href="UTF8Handler.html">UTF8Handler</a> implements Unicode aware
operations for strings, these operations will be used by the <a
href="../Chars.html">Chars</a> proxy when $KCODE is set to
&#8216;UTF8&#8217;.
</p>
</div>




<p></p>


<h1>Constants</h1><p><table><tr><th>Name</th><th>Value</th></tr>
<tr>
<td class="highlight">HANGUL_SBASE</td>

<td class="normal">0xAC00</td>



</tr>
<tr>
<td class="highlight">HANGUL_LBASE</td>

<td class="normal">0x1100</td>



</tr>
<tr>
<td class="highlight">HANGUL_VBASE</td>

<td class="normal">0x1161</td>



</tr>
<tr>
<td class="highlight">HANGUL_TBASE</td>

<td class="normal">0x11A7</td>



</tr>
<tr>
<td class="highlight">HANGUL_LCOUNT</td>

<td class="normal">19</td>



</tr>
<tr>
<td class="highlight">HANGUL_VCOUNT</td>

<td class="normal">21</td>



</tr>
<tr>
<td class="highlight">HANGUL_TCOUNT</td>

<td class="normal">28</td>



</tr>
<tr>
<td class="highlight">HANGUL_NCOUNT</td>

<td class="normal">HANGUL_VCOUNT * HANGUL_TCOUNT</td>



</tr>
<tr>
<td class="highlight">HANGUL_SCOUNT</td>

<td class="normal">11172</td>



</tr>
<tr>
<td class="highlight">HANGUL_SLAST</td>

<td class="normal">HANGUL_SBASE + HANGUL_SCOUNT</td>



</tr>
<tr>
<td class="highlight">HANGUL_JAMO_FIRST</td>

<td class="normal">0x1100</td>



</tr>
<tr>
<td class="highlight">HANGUL_JAMO_LAST</td>

<td class="normal">0x11FF</td>



</tr>
<tr>
<td class="highlight">UNICODE_WHITESPACE</td>

<td class="normal">[       (0x0009..0x000D).to_a,  # White_Space # Cc   [5] &lt;control-0009&gt;..&lt;control-000D&gt;       0x0020,          # White_Space # Zs       SPACE       0x0085,          # White_Space # Cc       &lt;control-0085&gt;       0x00A0,          # White_Space # Zs       NO-BREAK SPACE       0x1680,          # White_Space # Zs       OGHAM SPACE MARK       0x180E,          # White_Space # Zs       MONGOLIAN VOWEL SEPARATOR       (0x2000..0x200A).to_a, # White_Space # Zs  [11] EN QUAD..HAIR SPACE       0x2028,          # White_Space # Zl       LINE SEPARATOR       0x2029,          # White_Space # Zp       PARAGRAPH SEPARATOR       0x202F,          # White_Space # Zs       NARROW NO-BREAK SPACE       0x205F,          # White_Space # Zs       MEDIUM MATHEMATICAL SPACE       0x3000,          # White_Space # Zs       IDEOGRAPHIC SPACE     ].flatten.freeze</td>



</tr>
<tr>
<td class="highlight">UNICODE_LEADERS_AND_TRAILERS</td>

<td class="normal">UNICODE_WHITESPACE + [65279]</td>



</tr>
<tr>
<td class="highlight">UTF8_PAT</td>

<td class="normal">/\A(?:                    [\x00-\x7f]                                     |                    [\xc2-\xdf] [\x80-\xbf]                         |                    \xe0        [\xa0-\xbf] [\x80-\xbf]             |                    [\xe1-\xef] [\x80-\xbf] [\x80-\xbf]             |                    \xf0        [\x90-\xbf] [\x80-\xbf] [\x80-\xbf] |                    [\xf1-\xf3] [\x80-\xbf] [\x80-\xbf] [\x80-\xbf] |                    \xf4        [\x80-\x8f] [\x80-\xbf] [\x80-\xbf]                   )*\z/xn</td>



</tr>
<tr>
<td class="highlight">UNICODE_TRAILERS_PAT</td>

<td class="normal">/(#{codepoints_to_pattern(UNICODE_LEADERS_AND_TRAILERS)})+\Z/</td>



</tr>
<tr>
<td class="highlight">UNICODE_LEADERS_PAT</td>

<td class="normal">/\A(#{codepoints_to_pattern(UNICODE_LEADERS_AND_TRAILERS)})+/</td>



</tr>
<tr>
<td class="highlight">UCD</td>

<td class="normal">UnicodeDatabase.new</td>



</tr>
</table></p>

<h1>Aliases</h1><p><table><tr><th>Old name</th><th>New name</th></tr>
<tr>


<td class="highlight">size</td>

<td class="normal">length</td>

</tr>
<tr>


<td class="highlight">slice</td>

<td class="normal">[]</td>

</tr>
</table></p>



<h1>Public Class Methods</h1>


<a class="small" name="M000558"><br/></a>
<div class="method_block"><h3>
<a href='#M000558'>


[]=

(str, *args)

</a>
</h3>
<p>
Works just like the indexed replace method on string, except instead of
byte offsets you specify character offsets.
</p>
<p>
Example:
</p>
<pre>
  s = &quot;Müller&quot;
  s.chars[2] = &quot;e&quot; # Replace character with offset 2
  s
  #=&gt; &quot;Müeler&quot;

  s = &quot;Müller&quot;
  s.chars[1, 2] = &quot;ö&quot; # Replace 2 characters at character offset 1
  s
  #=&gt; &quot;Möler&quot;
</pre>

<p class="source_link" id="M000558-show-link"><a onclick="toggle('M000558-source'); toggleText('M000558-link'); return false;" href="#" id="M000558-link">Show source...</a></p><div class="source" id="M000558-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 158</span>
158:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
159:         <span class="ruby-identifier">replace_by</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span>
160:         <span class="ruby-comment cmt"># Indexed replace with regular expressions already works</span>
161:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>] = <span class="ruby-identifier">replace_by</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
162:         <span class="ruby-identifier">result</span> = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)
163:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>)
164:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">IndexError</span>, <span class="ruby-node">&quot;index #{args[0]} out of string&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">length</span>
165:           <span class="ruby-identifier">min</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
166:           <span class="ruby-identifier">max</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-identifier">min</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">min</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)
167:           <span class="ruby-identifier">range</span> = <span class="ruby-constant">Range</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">min</span>, <span class="ruby-identifier">max</span>)
168:           <span class="ruby-identifier">replace_by</span> = [<span class="ruby-identifier">replace_by</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">replace_by</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>)
169:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Range</span>)
170:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">RangeError</span>, <span class="ruby-node">&quot;#{args[0]} out of range&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">min</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">length</span>
171:           <span class="ruby-identifier">range</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
172:         <span class="ruby-keyword kw">else</span>
173:           <span class="ruby-identifier">needle</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_s</span>
174:           <span class="ruby-identifier">min</span> = <span class="ruby-identifier">index</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">needle</span>)
175:           <span class="ruby-identifier">max</span> = <span class="ruby-identifier">min</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">length</span>(<span class="ruby-identifier">needle</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
176:           <span class="ruby-identifier">range</span> = <span class="ruby-constant">Range</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">min</span>, <span class="ruby-identifier">max</span>)
177:         <span class="ruby-keyword kw">end</span>
178:         <span class="ruby-identifier">result</span>[<span class="ruby-identifier">range</span>] = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">replace_by</span>)
179:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">result</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>))
180:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000570"><br/></a>
<div class="method_block"><h3>
<a href='#M000570'>


capitalize

(str)

</a>
</h3>
<p>
Returns a copy of <tt>str</tt> with the first character converted to
uppercase and the remainder to lowercase
</p>

<p class="source_link" id="M000570-show-link"><a onclick="toggle('M000570-source'); toggleText('M000570-link'); return false;" href="#" id="M000570-link">Show source...</a></p><div class="source" id="M000570-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 276</span>
276:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">capitalize</span>(<span class="ruby-identifier">str</span>)
277:         <span class="ruby-identifier">upcase</span>(<span class="ruby-identifier">slice</span>(<span class="ruby-identifier">str</span>, <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>)) <span class="ruby-operator">+</span> <span class="ruby-identifier">downcase</span>(<span class="ruby-identifier">slice</span>(<span class="ruby-identifier">str</span>, <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>) <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>)
278:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000561"><br/></a>
<div class="method_block"><h3>
<a href='#M000561'>


center

(str, integer, padstr=' ')

</a>
</h3>
<p>
Works just like String#center, only integer specifies characters instead of
bytes.
</p>
<p>
Example:
</p>
<pre>
  &quot;¾ cup&quot;.chars.center(8).to_s
  #=&gt; &quot; ¾ cup  &quot;

  &quot;¾ cup&quot;.chars.center(8, &quot; &quot;).to_s # Use non-breaking whitespace
  #=&gt; &quot; ¾ cup  &quot;
</pre>

<p class="source_link" id="M000561-show-link"><a onclick="toggle('M000561-source'); toggleText('M000561-link'); return false;" href="#" id="M000561-link">Show source...</a></p><div class="source" id="M000561-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 217</span>
217:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">center</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">integer</span>, <span class="ruby-identifier">padstr</span>=<span class="ruby-value str">' '</span>)
218:         <span class="ruby-identifier">justify</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">integer</span>, <span class="ruby-identifier">:center</span>, <span class="ruby-identifier">padstr</span>)
219:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000573"><br/></a>
<div class="method_block"><h3>
<a href='#M000573'>


compose

(str)

</a>
</h3>
<p>
Perform composition on the characters in the string
</p>

<p class="source_link" id="M000573-show-link"><a onclick="toggle('M000573-source'); toggleText('M000573-link'); return false;" href="#" id="M000573-link">Show source...</a></p><div class="source" id="M000573-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 312</span>
312:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compose</span>(<span class="ruby-identifier">str</span>)
313:         <span class="ruby-identifier">compose_codepoints</span> <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
314:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000575"><br/></a>
<div class="method_block"><h3>
<a href='#M000575'>


consumes?

(str)

</a>
</h3>
<p>
Checks if the string is valid UTF8.
</p>

<p class="source_link" id="M000575-show-link"><a onclick="toggle('M000575-source'); toggleText('M000575-link'); return false;" href="#" id="M000575-link">Show source...</a></p><div class="source" id="M000575-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 342</span>
342:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">consumes?</span>(<span class="ruby-identifier">str</span>)
343:         <span class="ruby-comment cmt"># Unpack is a little bit faster than regular expressions</span>
344:         <span class="ruby-keyword kw">begin</span>
345:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'U*'</span>)
346:           <span class="ruby-keyword kw">true</span>
347:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span>
348:           <span class="ruby-keyword kw">false</span>
349:         <span class="ruby-keyword kw">end</span>
350:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000572"><br/></a>
<div class="method_block"><h3>
<a href='#M000572'>


decompose

(str)

</a>
</h3>
<p>
Perform decomposition on the characters in the string
</p>

<p class="source_link" id="M000572-show-link"><a onclick="toggle('M000572-source'); toggleText('M000572-link'); return false;" href="#" id="M000572-link">Show source...</a></p><div class="source" id="M000572-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 307</span>
307:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decompose</span>(<span class="ruby-identifier">str</span>)
308:         <span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">:canonical</span>, <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)).<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
309:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000569"><br/></a>
<div class="method_block"><h3>
<a href='#M000569'>


downcase

(str)

</a>
</h3>
<p>
Convert characters in the string to lowercase
</p>

<p class="source_link" id="M000569-show-link"><a onclick="toggle('M000569-source'); toggleText('M000569-link'); return false;" href="#" id="M000569-link">Show source...</a></p><div class="source" id="M000569-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 273</span>
273:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">downcase</span>(<span class="ruby-identifier">str</span>); <span class="ruby-identifier">to_case</span> <span class="ruby-identifier">:lowercase_mapping</span>, <span class="ruby-identifier">str</span>; <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000576"><br/></a>
<div class="method_block"><h3>
<a href='#M000576'>


g_length

(str)

</a>
</h3>
<p>
Returns the number of grapheme clusters in the string. This method is very
likely to be moved or renamed in future versions.
</p>

<p class="source_link" id="M000576-show-link"><a onclick="toggle('M000576-source'); toggleText('M000576-link'); return false;" href="#" id="M000576-link">Show source...</a></p><div class="source" id="M000576-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 354</span>
354:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">g_length</span>(<span class="ruby-identifier">str</span>)
355:         <span class="ruby-identifier">g_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">length</span>
356:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000557"><br/></a>
<div class="method_block"><h3>
<a href='#M000557'>


index

(str, *args)

</a>
</h3>
<p>
Returns the position of the passed argument in the string, counting in
codepoints
</p>

<p class="source_link" id="M000557-show-link"><a onclick="toggle('M000557-source'); toggleText('M000557-link'); return false;" href="#" id="M000557-link">Show source...</a></p><div class="source" id="M000557-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 139</span>
139:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
140:         <span class="ruby-identifier">bidx</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">index</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
141:         <span class="ruby-identifier">bidx</span> <span class="ruby-value">? </span>(<span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">bidx</span>)).<span class="ruby-identifier">size</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
142:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000556"><br/></a>
<div class="method_block"><h3>
<a href='#M000556'>


insert

(str, offset, fragment)

</a>
</h3>
<p>
Inserts the passed string at specified codepoint offsets
</p>

<p class="source_link" id="M000556-show-link"><a onclick="toggle('M000556-source'); toggleText('M000556-link'); return false;" href="#" id="M000556-link">Show source...</a></p><div class="source" id="M000556-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 129</span>
129:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">fragment</span>)
130:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">replace</span>(
131:           <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">insert</span>(
132:             <span class="ruby-identifier">offset</span>,
133:             <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">fragment</span>)
134:           ).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
135:         )
136:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000560"><br/></a>
<div class="method_block"><h3>
<a href='#M000560'>


ljust

(str, integer, padstr=' ')

</a>
</h3>
<p>
Works just like String#ljust, only integer specifies characters instead of
bytes.
</p>
<p>
Example:
</p>
<pre>
  &quot;¾ cup&quot;.chars.rjust(8).to_s
  #=&gt; &quot;¾ cup   &quot;

  &quot;¾ cup&quot;.chars.rjust(8, &quot; &quot;).to_s # Use non-breaking whitespace
  #=&gt; &quot;¾ cup   &quot;
</pre>

<p class="source_link" id="M000560-show-link"><a onclick="toggle('M000560-source'); toggleText('M000560-link'); return false;" href="#" id="M000560-link">Show source...</a></p><div class="source" id="M000560-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 204</span>
204:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ljust</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">integer</span>, <span class="ruby-identifier">padstr</span>=<span class="ruby-value str">' '</span>)
205:         <span class="ruby-identifier">justify</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">integer</span>, <span class="ruby-identifier">:left</span>, <span class="ruby-identifier">padstr</span>)
206:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000563"><br/></a>
<div class="method_block"><h3>
<a href='#M000563'>


lstrip

(str)

</a>
</h3>
<p>
Does Unicode-aware <a href="UTF8Handler.html#M000563">lstrip</a>
</p>

<p class="source_link" id="M000563-show-link"><a onclick="toggle('M000563-source'); toggleText('M000563-link'); return false;" href="#" id="M000563-link">Show source...</a></p><div class="source" id="M000563-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 227</span>
227:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lstrip</span>(<span class="ruby-identifier">str</span>)
228:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_LEADERS_PAT</span>, <span class="ruby-value str">''</span>)
229:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000571"><br/></a>
<div class="method_block"><h3>
<a href='#M000571'>


normalize

(str, form=ActiveSupport::Multibyte::DEFAULT_NORMALIZATION_FORM)

</a>
</h3>
<p>
Returns the KC normalization of the string by default. NFKC is considered
the best normalization form for passing strings to databases and
validations.
</p>
<ul>
<li><tt>str</tt> - The string to perform normalization on.

</li>
<li><tt>form</tt> - The form you want to <a
href="UTF8Handler.html#M000571">normalize</a> in. Should be one of the
following: :c, :kc, :d or :kd.

</li>
</ul>

<p class="source_link" id="M000571-show-link"><a onclick="toggle('M000571-source'); toggleText('M000571-link'); return false;" href="#" id="M000571-link">Show source...</a></p><div class="source" id="M000571-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 289</span>
289:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">normalize</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">form</span>=<span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Multibyte</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_NORMALIZATION_FORM</span>)
290:         <span class="ruby-comment cmt"># See http://www.unicode.org/reports/tr15, Table 1</span>
291:         <span class="ruby-identifier">codepoints</span> = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)
292:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">form</span>
293:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:d</span>
294:             <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">:canonical</span>, <span class="ruby-identifier">codepoints</span>))
295:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:c</span>
296:             <span class="ruby-identifier">compose_codepoints</span> <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">:canonical</span>, <span class="ruby-identifier">codepoints</span>))
297:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:kd</span>
298:             <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">:compatability</span>, <span class="ruby-identifier">codepoints</span>))
299:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:kc</span>
300:             <span class="ruby-identifier">compose_codepoints</span> <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">:compatability</span>, <span class="ruby-identifier">codepoints</span>))
301:           <span class="ruby-keyword kw">else</span>
302:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;#{form} is not a valid normalization variant&quot;</span>, <span class="ruby-identifier">caller</span>
303:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
304:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000566"><br/></a>
<div class="method_block"><h3>
<a href='#M000566'>


reverse

(str)

</a>
</h3>
<p>
Reverses codepoints in the string.
</p>

<p class="source_link" id="M000566-show-link"><a onclick="toggle('M000566-source'); toggleText('M000566-link'); return false;" href="#" id="M000566-link">Show source...</a></p><div class="source" id="M000566-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 243</span>
243:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reverse</span>(<span class="ruby-identifier">str</span>)
244:         <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
245:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000559"><br/></a>
<div class="method_block"><h3>
<a href='#M000559'>


rjust

(str, integer, padstr=' ')

</a>
</h3>
<p>
Works just like String#rjust, only integer specifies characters instead of
bytes.
</p>
<p>
Example:
</p>
<pre>
  &quot;¾ cup&quot;.chars.rjust(8).to_s
  #=&gt; &quot;   ¾ cup&quot;

  &quot;¾ cup&quot;.chars.rjust(8, &quot; &quot;).to_s # Use non-breaking whitespace
  #=&gt; &quot;   ¾ cup&quot;
</pre>

<p class="source_link" id="M000559-show-link"><a onclick="toggle('M000559-source'); toggleText('M000559-link'); return false;" href="#" id="M000559-link">Show source...</a></p><div class="source" id="M000559-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 191</span>
191:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rjust</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">integer</span>, <span class="ruby-identifier">padstr</span>=<span class="ruby-value str">' '</span>)
192:         <span class="ruby-identifier">justify</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">integer</span>, <span class="ruby-identifier">:right</span>, <span class="ruby-identifier">padstr</span>)
193:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000562"><br/></a>
<div class="method_block"><h3>
<a href='#M000562'>


rstrip

(str)

</a>
</h3>
<p>
Does Unicode-aware <a href="UTF8Handler.html#M000562">rstrip</a>
</p>

<p class="source_link" id="M000562-show-link"><a onclick="toggle('M000562-source'); toggleText('M000562-link'); return false;" href="#" id="M000562-link">Show source...</a></p><div class="source" id="M000562-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 222</span>
222:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rstrip</span>(<span class="ruby-identifier">str</span>)
223:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_TRAILERS_PAT</span>, <span class="ruby-value str">''</span>)
224:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000565"><br/></a>
<div class="method_block"><h3>
<a href='#M000565'>


size

(str)

</a>
</h3>
<p>
Returns the number of codepoints in the string
</p>

<p class="source_link" id="M000565-show-link"><a onclick="toggle('M000565-source'); toggleText('M000565-link'); return false;" href="#" id="M000565-link">Show source...</a></p><div class="source" id="M000565-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 237</span>
237:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">size</span>(<span class="ruby-identifier">str</span>)
238:         <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">size</span>
239:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000567"><br/></a>
<div class="method_block"><h3>
<a href='#M000567'>


slice

(str, *args)

</a>
</h3>
<p>
Implements Unicode-aware <a href="UTF8Handler.html#M000567">slice</a> with
codepoints. Slicing on one point returns the codepoints for that character.
</p>

<p class="source_link" id="M000567-show-link"><a onclick="toggle('M000567-source'); toggleText('M000567-link'); return false;" href="#" id="M000567-link">Show source...</a></p><div class="source" id="M000567-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 249</span>
249:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">slice</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
250:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>
251:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;wrong number of arguments (#{args.size} for 1)&quot;</span> <span class="ruby-comment cmt"># Do as if we were native</span>
252:         <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Numeric</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)))
253:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;cannot convert #{args.first.class} into Integer&quot;</span> <span class="ruby-comment cmt"># Do as if we were native</span>
254:         <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Numeric</span>))
255:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;cannot convert #{args[1].class} into Integer&quot;</span> <span class="ruby-comment cmt"># Do as if we were native</span>
256:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Range</span>
257:           <span class="ruby-identifier">cps</span> = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">slice</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
258:           <span class="ruby-identifier">cps</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cps</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
259:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Regexp</span>
260:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
261:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Numeric</span>)
262:           <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)[<span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]]
263:         <span class="ruby-keyword kw">else</span>
264:           <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">slice</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>).<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
265:         <span class="ruby-keyword kw">end</span>
266:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000564"><br/></a>
<div class="method_block"><h3>
<a href='#M000564'>


strip

(str)

</a>
</h3>
<p>
Removed leading and trailing whitespace
</p>

<p class="source_link" id="M000564-show-link"><a onclick="toggle('M000564-source'); toggleText('M000564-link'); return false;" href="#" id="M000564-link">Show source...</a></p><div class="source" id="M000564-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 232</span>
232:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">strip</span>(<span class="ruby-identifier">str</span>)
233:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_LEADERS_PAT</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_TRAILERS_PAT</span>, <span class="ruby-value str">''</span>)
234:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000577"><br/></a>
<div class="method_block"><h3>
<a href='#M000577'>


tidy_bytes

(str)

</a>
</h3>
<p>
Replaces all the non-utf-8 bytes by their iso-8859-1 or cp1252 equivalent
resulting in a valid utf-8 string
</p>

<p class="source_link" id="M000577-show-link"><a onclick="toggle('M000577-source'); toggleText('M000577-link'); return false;" href="#" id="M000577-link">Show source...</a></p><div class="source" id="M000577-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 359</span>
359:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tidy_bytes</span>(<span class="ruby-identifier">str</span>)
360:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">//</span><span class="ruby-identifier">u</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
361:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">UTF8_PAT</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">c</span>)
362:             <span class="ruby-identifier">n</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'C'</span>)[<span class="ruby-value">0</span>]
363:             <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">128</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">chr</span> <span class="ruby-operator">:</span>
364:             <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">160</span> <span class="ruby-operator">?</span> [<span class="ruby-constant">UCD</span>.<span class="ruby-identifier">cp1252</span>[<span class="ruby-identifier">n</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U'</span>) <span class="ruby-operator">:</span>
365:             <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">192</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;\xC2&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">chr</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;\xC3&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">n</span><span class="ruby-operator">-</span><span class="ruby-value">64</span>).<span class="ruby-identifier">chr</span>
366:           <span class="ruby-keyword kw">else</span>
367:             <span class="ruby-identifier">c</span>
368:           <span class="ruby-keyword kw">end</span>
369:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">join</span>
370:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000574"><br/></a>
<div class="method_block"><h3>
<a href='#M000574'>


translate_offset

(str, byte_offset)

</a>
</h3>
<p>
Used to translate an offset from bytes to characters, for instance one
received from a regular expression match
</p>

<p class="source_link" id="M000574-show-link"><a onclick="toggle('M000574-source'); toggleText('M000574-link'); return false;" href="#" id="M000574-link">Show source...</a></p><div class="source" id="M000574-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 321</span>
321:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">translate_offset</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">byte_offset</span>)
322:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">byte_offset</span>.<span class="ruby-identifier">nil?</span>
323:         <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span>
324:         <span class="ruby-identifier">chunk</span> = <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">byte_offset</span>]
325:         <span class="ruby-keyword kw">begin</span>
326:           <span class="ruby-keyword kw">begin</span>
327:             <span class="ruby-identifier">chunk</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'U*'</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
328:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
329:             <span class="ruby-identifier">chunk</span> = <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">byte_offset</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>)]
330:             <span class="ruby-comment cmt"># Stop retrying at the end of the string</span>
331:             <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">byte_offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">chunk</span>.<span class="ruby-identifier">length</span> 
332:             <span class="ruby-comment cmt"># We damaged a character, retry</span>
333:             <span class="ruby-keyword kw">retry</span>
334:           <span class="ruby-keyword kw">end</span>
335:         <span class="ruby-comment cmt"># Catch the ArgumentError so we can throw our own</span>
336:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span> 
337:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncodingError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'malformed UTF-8 character'</span>)
338:         <span class="ruby-keyword kw">end</span>
339:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000568"><br/></a>
<div class="method_block"><h3>
<a href='#M000568'>


upcase

(str)

</a>
</h3>
<p>
Convert characters in the string to uppercase
</p>

<p class="source_link" id="M000568-show-link"><a onclick="toggle('M000568-source'); toggleText('M000568-link'); return false;" href="#" id="M000568-link">Show source...</a></p><div class="source" id="M000568-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 270</span>
270:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">upcase</span>(<span class="ruby-identifier">str</span>); <span class="ruby-identifier">to_case</span> <span class="ruby-identifier">:uppercase_mapping</span>, <span class="ruby-identifier">str</span>; <span class="ruby-keyword kw">end</span></pre></div>
</div>


<h1>Protected Class Methods</h1>


<a class="small" name="M000587"><br/></a>
<div class="method_block"><h3>
<a href='#M000587'>


compose_codepoints

(codepoints)

</a>
</h3>
<p>
Compose decomposed characters to the composed form
</p>

<p class="source_link" id="M000587-show-link"><a onclick="toggle('M000587-source'); toggleText('M000587-link'); return false;" href="#" id="M000587-link">Show source...</a></p><div class="source" id="M000587-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 503</span>
503:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compose_codepoints</span>(<span class="ruby-identifier">codepoints</span>)
504:         <span class="ruby-identifier">pos</span> = <span class="ruby-value">0</span>
505:         <span class="ruby-identifier">eoa</span> = <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
506:         <span class="ruby-identifier">starter_pos</span> = <span class="ruby-value">0</span>
507:         <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-value">0</span>]
508:         <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-value">-1</span>
509:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">eoa</span>
510:           <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
511:           <span class="ruby-identifier">lindex</span> = <span class="ruby-identifier">starter_char</span> <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_LBASE</span>
512:           <span class="ruby-comment cmt"># -- Hangul</span>
513:           <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">lindex</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">lindex</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_LCOUNT</span>
514:             <span class="ruby-identifier">vindex</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>] <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_VBASE</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">vindex</span> = <span class="ruby-value">-1</span>
515:             <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">vindex</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">vindex</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_VCOUNT</span>
516:               <span class="ruby-identifier">tindex</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span><span class="ruby-operator">+</span><span class="ruby-value">2</span>] <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_TBASE</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">tindex</span> = <span class="ruby-value">-1</span>
517:               <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">tindex</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">tindex</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_TCOUNT</span>
518:                 <span class="ruby-identifier">j</span> = <span class="ruby-identifier">starter_pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>
519:                 <span class="ruby-identifier">eoa</span> <span class="ruby-operator">-=</span> <span class="ruby-value">2</span>
520:               <span class="ruby-keyword kw">else</span>
521:                 <span class="ruby-identifier">tindex</span> = <span class="ruby-value">0</span>
522:                 <span class="ruby-identifier">j</span> = <span class="ruby-identifier">starter_pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
523:                 <span class="ruby-identifier">eoa</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
524:               <span class="ruby-keyword kw">end</span>
525:               <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span><span class="ruby-operator">..</span><span class="ruby-identifier">j</span>] = (<span class="ruby-identifier">lindex</span> <span class="ruby-operator">*</span> <span class="ruby-constant">HANGUL_VCOUNT</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">vindex</span>) <span class="ruby-operator">*</span> <span class="ruby-constant">HANGUL_TCOUNT</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tindex</span> <span class="ruby-operator">+</span> <span class="ruby-constant">HANGUL_SBASE</span>
526:             <span class="ruby-keyword kw">end</span>
527:             <span class="ruby-identifier">starter_pos</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
528:             <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span>]
529:           <span class="ruby-comment cmt"># -- Other characters</span>
530:           <span class="ruby-keyword kw">else</span>
531:             <span class="ruby-identifier">current_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]
532:             <span class="ruby-identifier">current</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">current_char</span>]
533:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">previous_combining_class</span>
534:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ref</span> = <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">composition_map</span>[<span class="ruby-identifier">starter_char</span>]
535:                 <span class="ruby-identifier">composition</span> = <span class="ruby-identifier">ref</span>[<span class="ruby-identifier">current_char</span>]
536:               <span class="ruby-keyword kw">else</span>
537:                 <span class="ruby-identifier">composition</span> = <span class="ruby-keyword kw">nil</span>
538:               <span class="ruby-keyword kw">end</span>
539:               <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">composition</span>.<span class="ruby-identifier">nil?</span>
540:                 <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span>] = <span class="ruby-identifier">composition</span>
541:                 <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">composition</span>
542:                 <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">delete_at</span> <span class="ruby-identifier">pos</span>
543:                 <span class="ruby-identifier">eoa</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
544:                 <span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
545:                 <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-value">-1</span>
546:               <span class="ruby-keyword kw">else</span>
547:                 <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span>
548:               <span class="ruby-keyword kw">end</span>
549:             <span class="ruby-keyword kw">else</span>
550:               <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span>
551:             <span class="ruby-keyword kw">end</span>
552:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
553:               <span class="ruby-identifier">starter_pos</span> = <span class="ruby-identifier">pos</span>
554:               <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]
555:             <span class="ruby-keyword kw">end</span>
556:           <span class="ruby-keyword kw">end</span>
557:         <span class="ruby-keyword kw">end</span>
558:         <span class="ruby-identifier">codepoints</span>
559:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000586"><br/></a>
<div class="method_block"><h3>
<a href='#M000586'>


decompose_codepoints

(type, codepoints)

</a>
</h3>
<p>
Decompose composed characters to the decomposed form
</p>

<p class="source_link" id="M000586-show-link"><a onclick="toggle('M000586-source'); toggleText('M000586-link'); return false;" href="#" id="M000586-link">Show source...</a></p><div class="source" id="M000586-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 482</span>
482:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">codepoints</span>)
483:         <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">decomposed</span>, <span class="ruby-identifier">cp</span><span class="ruby-operator">|</span>
484:           <span class="ruby-comment cmt"># if it's a hangul syllable starter character</span>
485:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">HANGUL_SBASE</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">cp</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">cp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_SLAST</span>
486:             <span class="ruby-identifier">sindex</span> = <span class="ruby-identifier">cp</span> <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_SBASE</span>
487:             <span class="ruby-identifier">ncp</span> = [] <span class="ruby-comment cmt"># new codepoints</span>
488:             <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">HANGUL_LBASE</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sindex</span> <span class="ruby-operator">/</span> <span class="ruby-constant">HANGUL_NCOUNT</span>
489:             <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">HANGUL_VBASE</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">sindex</span> <span class="ruby-operator">%</span> <span class="ruby-constant">HANGUL_NCOUNT</span>) <span class="ruby-operator">/</span> <span class="ruby-constant">HANGUL_TCOUNT</span>
490:             <span class="ruby-identifier">tindex</span> = <span class="ruby-identifier">sindex</span> <span class="ruby-operator">%</span> <span class="ruby-constant">HANGUL_TCOUNT</span>
491:             <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-constant">HANGUL_TBASE</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tindex</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">tindex</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
492:             <span class="ruby-identifier">decomposed</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">ncp</span>
493:           <span class="ruby-comment cmt"># if the codepoint is decomposable in with the current decomposition type</span>
494:           <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">ncp</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">cp</span>].<span class="ruby-identifier">decomp_mapping</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-operator">!</span><span class="ruby-constant">UCD</span>[<span class="ruby-identifier">cp</span>].<span class="ruby-identifier">decomp_type</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:compatability</span>)
495:             <span class="ruby-identifier">decomposed</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">ncp</span>.<span class="ruby-identifier">dup</span>)
496:           <span class="ruby-keyword kw">else</span>
497:             <span class="ruby-identifier">decomposed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cp</span>
498:           <span class="ruby-keyword kw">end</span>
499:         <span class="ruby-keyword kw">end</span>
500:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000581"><br/></a>
<div class="method_block"><h3>
<a href='#M000581'>


g_pack

(unpacked)

</a>
</h3>
<p>
Reverse operation of <a href="UTF8Handler.html#M000580">g_unpack</a>
</p>

<p class="source_link" id="M000581-show-link"><a onclick="toggle('M000581-source'); toggleText('M000581-link'); return false;" href="#" id="M000581-link">Show source...</a></p><div class="source" id="M000581-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 421</span>
421:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">g_pack</span>(<span class="ruby-identifier">unpacked</span>)
422:         <span class="ruby-identifier">unpacked</span>.<span class="ruby-identifier">flatten</span>
423:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000580"><br/></a>
<div class="method_block"><h3>
<a href='#M000580'>


g_unpack

(str)

</a>
</h3>
<p>
Unpack the string at grapheme boundaries instead of codepoint boundaries
</p>

<p class="source_link" id="M000580-show-link"><a onclick="toggle('M000580-source'); toggleText('M000580-link'); return false;" href="#" id="M000580-link">Show source...</a></p><div class="source" id="M000580-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 390</span>
390:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">g_unpack</span>(<span class="ruby-identifier">str</span>)
391:         <span class="ruby-identifier">codepoints</span> = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)
392:         <span class="ruby-identifier">unpacked</span> = []
393:         <span class="ruby-identifier">pos</span> = <span class="ruby-value">0</span>
394:         <span class="ruby-identifier">marker</span> = <span class="ruby-value">0</span>
395:         <span class="ruby-identifier">eoc</span> = <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">length</span>
396:         <span class="ruby-keyword kw">while</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">eoc</span>)
397:           <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
398:           <span class="ruby-identifier">previous</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
399:           <span class="ruby-identifier">current</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]
400:           <span class="ruby-keyword kw">if</span> (
401:               <span class="ruby-comment cmt"># CR X LF</span>
402:               <span class="ruby-identifier">one</span> = ( <span class="ruby-identifier">previous</span> <span class="ruby-operator">==</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-identifier">:cr</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current</span> <span class="ruby-operator">==</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-identifier">:lf</span>] ) <span class="ruby-keyword kw">or</span>
403:               <span class="ruby-comment cmt"># L X (L|V|LV|LVT)</span>
404:               <span class="ruby-identifier">two</span> = ( <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-identifier">:l</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">previous</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">current</span>, [<span class="ruby-identifier">:l</span>,<span class="ruby-identifier">:v</span>,<span class="ruby-identifier">:lv</span>,<span class="ruby-identifier">:lvt</span>]) ) <span class="ruby-keyword kw">or</span>
405:               <span class="ruby-comment cmt"># (LV|V) X (V|T)</span>
406:               <span class="ruby-identifier">three</span> = ( <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">previous</span>, [<span class="ruby-identifier">:lv</span>,<span class="ruby-identifier">:v</span>]) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">current</span>, [<span class="ruby-identifier">:v</span>,<span class="ruby-identifier">:t</span>]) ) <span class="ruby-keyword kw">or</span>
407:               <span class="ruby-comment cmt"># (LVT|T) X (T)</span>
408:               <span class="ruby-identifier">four</span> = ( <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">previous</span>, [<span class="ruby-identifier">:lvt</span>,<span class="ruby-identifier">:t</span>]) <span class="ruby-keyword kw">and</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-identifier">:t</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">current</span> ) <span class="ruby-keyword kw">or</span>
409:               <span class="ruby-comment cmt"># X Extend</span>
410:               <span class="ruby-identifier">five</span> = (<span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-identifier">:extend</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">current</span>)
411:             )
412:           <span class="ruby-keyword kw">else</span>
413:             <span class="ruby-identifier">unpacked</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">marker</span><span class="ruby-operator">..</span><span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
414:             <span class="ruby-identifier">marker</span> = <span class="ruby-identifier">pos</span>
415:           <span class="ruby-keyword kw">end</span>
416:         <span class="ruby-keyword kw">end</span> 
417:         <span class="ruby-identifier">unpacked</span>
418:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000578"><br/></a>
<div class="method_block"><h3>
<a href='#M000578'>


in_char_class?

(codepoint, classes)

</a>
</h3>
<p>
Detect whether the codepoint is in a certain character class. Primarily
used by the grapheme cluster support.
</p>

<p class="source_link" id="M000578-show-link"><a onclick="toggle('M000578-source'); toggleText('M000578-link'); return false;" href="#" id="M000578-link">Show source...</a></p><div class="source" id="M000578-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 376</span>
376:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">codepoint</span>, <span class="ruby-identifier">classes</span>)
377:         <span class="ruby-identifier">classes</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-identifier">c</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">codepoint</span> } <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
378:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000582"><br/></a>
<div class="method_block"><h3>
<a href='#M000582'>


justify

(str, integer, way, padstr=' ')

</a>
</h3>
<p>
Justifies a string in a certain way. Valid values for <tt>way</tt> are
<tt>:right</tt>, <tt>:left</tt> and <tt>:<a
href="UTF8Handler.html#M000561">center</a></tt>. Is primarily used as a
helper method by <tt><a href="UTF8Handler.html#M000559">rjust</a></tt>,
<tt><a href="UTF8Handler.html#M000560">ljust</a></tt> and <tt><a
href="UTF8Handler.html#M000561">center</a></tt>.
</p>

<p class="source_link" id="M000582-show-link"><a onclick="toggle('M000582-source'); toggleText('M000582-link'); return false;" href="#" id="M000582-link">Show source...</a></p><div class="source" id="M000582-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 427</span>
427:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">justify</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">integer</span>, <span class="ruby-identifier">way</span>, <span class="ruby-identifier">padstr</span>=<span class="ruby-value str">' '</span>)
428:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;zero width padding&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">padstr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
429:         <span class="ruby-identifier">padsize</span> = <span class="ruby-identifier">integer</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">size</span>(<span class="ruby-identifier">str</span>)
430:         <span class="ruby-identifier">padsize</span> = <span class="ruby-identifier">padsize</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">padsize</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
431:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">way</span>
432:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:right</span>
433:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">padding</span>(<span class="ruby-identifier">padsize</span>, <span class="ruby-identifier">padstr</span>))
434:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:left</span>
435:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-value">-1</span>, <span class="ruby-identifier">padding</span>(<span class="ruby-identifier">padsize</span>, <span class="ruby-identifier">padstr</span>))
436:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:center</span>
437:           <span class="ruby-identifier">lpad</span> = <span class="ruby-identifier">padding</span>((<span class="ruby-identifier">padsize</span> <span class="ruby-operator">/</span> <span class="ruby-value">2.0</span>).<span class="ruby-identifier">floor</span>, <span class="ruby-identifier">padstr</span>)
438:           <span class="ruby-identifier">rpad</span> = <span class="ruby-identifier">padding</span>((<span class="ruby-identifier">padsize</span> <span class="ruby-operator">/</span> <span class="ruby-value">2.0</span>).<span class="ruby-identifier">ceil</span>, <span class="ruby-identifier">padstr</span>)
439:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">lpad</span>).<span class="ruby-identifier">insert</span>(<span class="ruby-value">-1</span>, <span class="ruby-identifier">rpad</span>)
440:         <span class="ruby-keyword kw">end</span>
441:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000583"><br/></a>
<div class="method_block"><h3>
<a href='#M000583'>


padding

(padsize, padstr=' ')

</a>
</h3>
<p>
Generates a <a href="UTF8Handler.html#M000583">padding</a> string of a
certain <a href="UTF8Handler.html#M000565">size</a>.
</p>

<p class="source_link" id="M000583-show-link"><a onclick="toggle('M000583-source'); toggleText('M000583-link'); return false;" href="#" id="M000583-link">Show source...</a></p><div class="source" id="M000583-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 444</span>
444:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">padding</span>(<span class="ruby-identifier">padsize</span>, <span class="ruby-identifier">padstr</span>=<span class="ruby-value str">' '</span>)
445:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">padsize</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
446:           <span class="ruby-identifier">slice</span>(<span class="ruby-identifier">padstr</span> <span class="ruby-operator">*</span> ((<span class="ruby-identifier">padsize</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">size</span>(<span class="ruby-identifier">padstr</span>)) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>), <span class="ruby-value">0</span>, <span class="ruby-identifier">padsize</span>)
447:         <span class="ruby-keyword kw">else</span>
448:           <span class="ruby-value str">''</span>
449:         <span class="ruby-keyword kw">end</span>
450:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000585"><br/></a>
<div class="method_block"><h3>
<a href='#M000585'>


reorder_characters

(codepoints)

</a>
</h3>
<p>
Re-order codepoints so the string becomes canonical
</p>

<p class="source_link" id="M000585-show-link"><a onclick="toggle('M000585-source'); toggleText('M000585-link'); return false;" href="#" id="M000585-link">Show source...</a></p><div class="source" id="M000585-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 466</span>
466:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">codepoints</span>)
467:         <span class="ruby-identifier">length</span> = <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span> <span class="ruby-value">1</span>
468:         <span class="ruby-identifier">pos</span> = <span class="ruby-value">0</span>
469:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">length</span> <span class="ruby-keyword kw">do</span>
470:           <span class="ruby-identifier">cp1</span>, <span class="ruby-identifier">cp2</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]], <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]
471:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">cp1</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cp2</span>.<span class="ruby-identifier">combining_class</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cp2</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
472:             <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span><span class="ruby-operator">..</span><span class="ruby-identifier">pos</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>] = <span class="ruby-identifier">cp2</span>.<span class="ruby-identifier">code</span>, <span class="ruby-identifier">cp1</span>.<span class="ruby-identifier">code</span>
473:             <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> (<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-value">-1</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
474:           <span class="ruby-keyword kw">else</span>
475:             <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
476:           <span class="ruby-keyword kw">end</span>
477:         <span class="ruby-keyword kw">end</span>
478:         <span class="ruby-identifier">codepoints</span>
479:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000584"><br/></a>
<div class="method_block"><h3>
<a href='#M000584'>


to_case

(way, str)

</a>
</h3>
<p>
Convert characters to a different case
</p>

<p class="source_link" id="M000584-show-link"><a onclick="toggle('M000584-source'); toggleText('M000584-link'); return false;" href="#" id="M000584-link">Show source...</a></p><div class="source" id="M000584-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 453</span>
453:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_case</span>(<span class="ruby-identifier">way</span>, <span class="ruby-identifier">str</span>)
454:         <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">codepoint</span><span class="ruby-operator">|</span>
455:           <span class="ruby-identifier">cp</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">codepoint</span>] 
456:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">nil?</span>
457:             <span class="ruby-identifier">ncp</span> = <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">way</span>)
458:             <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ncp</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">codepoint</span>
459:           <span class="ruby-keyword kw">else</span>
460:             <span class="ruby-identifier">codepoint</span>
461:           <span class="ruby-keyword kw">end</span>
462:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
463:       <span class="ruby-keyword kw">end</span></pre></div>
</div>

<a class="small" name="M000579"><br/></a>
<div class="method_block"><h3>
<a href='#M000579'>


u_unpack

(str)

</a>
</h3>
<p>
Unpack the string at codepoints boundaries
</p>

<p class="source_link" id="M000579-show-link"><a onclick="toggle('M000579-source'); toggleText('M000579-link'); return false;" href="#" id="M000579-link">Show source...</a></p><div class="source" id="M000579-source"><pre>     <span class="ruby-comment cmt"># File vendor/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 381</span>
381:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)
382:         <span class="ruby-keyword kw">begin</span>
383:           <span class="ruby-identifier">str</span>.<span class="ruby-identifier">unpack</span> <span class="ruby-value str">'U*'</span>
384:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span>
385:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncodingError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'malformed UTF-8 character'</span>)
386:         <span class="ruby-keyword kw">end</span>
387:       <span class="ruby-keyword kw">end</span></pre></div>
</div>





</div><div class="clear" id="footer">Generated on Jan 21, 2008 / Allison 2 &copy; 2007 <a href="http://cloudbur.st">Cloudburst, LLC</a></div></div></body></html>